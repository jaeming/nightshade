{"version":3,"file":"bundle.js","sources":["../src/lib/template_parse.ts","../src/lib/reflection.ts","../test.reflect","../src/main.js"],"sourcesContent":["// TODO:\n// Handle self-closing tags (of both variations: \"/>\" and \">\")\n// add unique ID\n// add isReflected key (eg: \"{msg}\")\n// add attributes\n//   detect special events/directives, eg:\n//     onclick='handleClick', model='msg', if='foo===bar', each='items as item'\n// track dependencies so we know what element to re-render when state changes\n\nenum Bracket {\n  Open = '<',\n  End = '>',\n  Closing = '/'\n}\n\nconst BRACKETS = [Bracket.Open, Bracket.End, Bracket.Closing]\n\nenum TagState {\n  Opening = 'Opening',\n  Attributes = 'Attributes',\n  Opened = 'Opened',\n  Closing = 'Closing',\n  Closed = 'Closed'\n}\n\nexport class TemplateParse {\n  nodes = []\n  template = ''\n  buffer = ''\n  currentNode = null\n\n  constructor (template) {\n    this.template = template\n    console.log(template)\n    this.parse()\n  }\n\n  get isOpening () {\n    return this.currentNode.state === TagState.Opening\n  }\n\n  get isOpened () {\n    return this.currentNode.state === TagState.Opened\n  }\n\n  get isAttributes () {\n    return this.currentNode.state === TagState.Attributes\n  }\n\n  get isClosing () {\n    return this.currentNode.state === TagState.Closing\n  }\n\n  parse () {\n    for (let i = 0; i < this.template.length; i++) {\n      this.buffer = this.template[i]\n      this.process()\n    }\n  }\n\n  process () {\n    if (BRACKETS.includes(this.buffer as Bracket)) {\n      return this.setBracketState()\n    }\n    if (this.isOpening) this.setTag()\n    if (this.isAttributes) this.setAttributes()\n    if (this.isOpened) this.setTextNode()\n  }\n\n  setBracketState () {\n    if (this.buffer === Bracket.Open) this.openTag()\n    if (this.buffer === Bracket.Closing) this.closingTag()\n    if (this.buffer === Bracket.End) this.endTag()\n  }\n\n  setTag () {\n    if (this.buffer === ' ') {\n      this.setState(TagState.Attributes)\n      this.setAttributes()\n    } else {\n      this.currentNode.tag += this.buffer\n    }\n  }\n\n  setTextNode () {\n    if (this.currentNode.tag === 'text') {\n      // append to current text node\n      this.currentNode.content += this.buffer.replace('\\n', '')\n    } else {\n      this.setChild({ asTextNode: true })\n    }\n  }\n\n  setAttributes () {\n    if (!this.attributes) {\n      this.currentNode.attributes = [{ statement: '', key: '', value: '' }]\n    }\n    let { statement, key, value } = this.currentAttribute\n    let finishAttr = false\n    statement += this.buffer\n\n    if (statement === ' ') return // ignore space seperator\n    if (this.buffer === '=') return this.updateCurrentAttr({ statement }) // update and move on to key\n\n    const setValue = () => {\n      const index = statement.indexOf('=') + 1\n      const isQuote = this.buffer === statement[index]\n      const isClosingQuote = statement.length - 1 > index\n      if (isQuote && isClosingQuote) {\n        finishAttr = true\n      } else {\n        value += this.buffer\n      }\n    }\n    const setKey = () => {\n      if (this.buffer === ' ') {\n        // self-assigned attribute\n        statement = `${key}=${key}`\n        value = key\n        finishAttr = true\n      } else {\n        const keyFinished = this.buffer === \"'\" || this.buffer === '\"'\n        if (!keyFinished) key += this.buffer\n      }\n    }\n\n    statement.includes('=') ? setValue() : setKey()\n    this.updateCurrentAttr({ statement, key, value })\n\n    if (finishAttr) {\n      value = value.replace(/\"/g, '') // remove escaped quotes\n      this.updateCurrentAttr({ value })\n      this.currentNode.attributes.push({ statement: '', key: '', value: '' })\n    }\n  }\n\n  get attributes () {\n    return this.currentNode.attributes\n  }\n\n  get currentAttribute () {\n    if (!this.attributes) return\n    return this.attributes[this.attributes.length - 1]\n  }\n\n  removeEmptyAttrs () {\n    if (this.currentAttribute?.statement === '') {\n      this.currentNode.attributes.splice(this.currentNode.attributes.length - 1)\n    }\n  }\n\n  updateCurrentAttr (val) {\n    this.attributes[this.attributes.length - 1] = {\n      ...this.attributes[this.attributes.length - 1],\n      ...val\n    }\n  }\n\n  openTag () {\n    if (!this.currentNode) {\n      this.setRoot()\n    } else if (this.isOpened) {\n      if (this.currentNode.tag === 'text') this.closeTextNode()\n      this.setChild({})\n    }\n  }\n\n  endTag () {\n    if (this.isOpening || this.isAttributes) {\n      this.setState(TagState.Opened)\n      this.removeEmptyAttrs()\n      this.nodes.push(this.currentNode)\n    }\n    if (this.isClosing) {\n      this.setState(TagState.Closed)\n      this.currentNode = this.findOpenParent(this.currentNode)\n    }\n  }\n\n  closingTag () {\n    // TODO: handle self closing tags\n    if (this.isOpening) {\n      // discard current node since it was just a closing tag\n      this.currentNode = this.currentNode.parent // go back to prev node\n    }\n    this.setState(TagState.Closing)\n  }\n\n  findOpenParent (node) {\n    // find closest open parent\n    const parent = node.parent\n    // if (!parent) return node // no more parents open\n    return parent.state.Closed ? this.findOpenParent(node) : parent\n  }\n\n  closeTextNode () {\n    this.setState(TagState.Closed)\n    if (this.currentNode.content.replace(/ /g, '').length) {\n      this.currentNode.content = this.currentNode.content.trim()\n      this.nodes.push(this.currentNode)\n    }\n    this.currentNode = this.currentNode.parent\n  }\n\n  setState (state: TagState) {\n    this.currentNode.state = state\n  }\n\n  setRoot () {\n    this.currentNode = { tag: '' }\n    this.currentNode.parent = { tag: 'ROOT', state: TagState.Opened }\n    this.setState(TagState.Opening)\n  }\n\n  setChild ({ asTextNode }: { asTextNode?: boolean }) {\n    const parent = this.currentNode\n    this.currentNode = asTextNode\n      ? {\n          state: TagState.Opened,\n          tag: 'text',\n          content: this.buffer.replace('\\n', ''),\n          parent\n        }\n      : { state: TagState.Opening, tag: '', parent }\n  }\n}\n","import { TemplateParse } from './template_parse'\n\nexport default class Reflection {\n  root = null\n\n  mount (Component, element) {\n    this.root = document.querySelector(element)\n    const component = new Component()\n    const nodes = new TemplateParse(component.template).nodes\n    console.log(nodes)\n  }\n}\n","\n  const foo = 'bar'\n\n  export default class Foo {\n  template = \"<div>\\n  Main Div here...\\n  <p id=\\\"main-text\\\" class=\\\"foo bar moar\\\" data-role=\\\"test\\\">\\n    a paragraph...\\n  </p>\\n  <h3>{msg}</h3>\\n  <div>\\n    <ul>\\n      <li>item one</li>\\n      <li>item two</li>\\n    </ul>\\n  </div>\\n  more main here!\\n</div>\\n\\n\\n\"\n    msg = 'Hello World!'\n\n    sayFoo () {\n      return foo\n    }\n  }\n","import Reflection from './lib/reflection'\nimport Test from './test.reflect'\n\nconst app = new Reflection()\n\napp.mount(Test, '#app')\n"],"names":["Test"],"mappings":"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"}